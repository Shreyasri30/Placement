CREATE DATABASE SHOPDB;
USE SHOPDB;

CREATE TABLE Staff (
  STAFF_ID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
  GIVEN_NAME VARCHAR(25),
  SURNAME VARCHAR(25),
  PAY INT,
  HIRED_AT DATETIME,
  TEAM VARCHAR(25)
);

CREATE TABLE Reward (
  STAFF_REF INT,
  AMOUNT INT,
  REWARD_DATE DATETIME,
  FOREIGN KEY (STAFF_REF) REFERENCES Staff(STAFF_ID) ON DELETE CASCADE
);

CREATE TABLE Role (
  STAFF_REF INT,
  ROLE_NAME VARCHAR(25),
  EFFECTIVE_FROM DATETIME,
  FOREIGN KEY (STAFF_REF) REFERENCES Staff(STAFF_ID) ON DELETE CASCADE
);


INSERT INTO Staff (STAFF_ID, GIVEN_NAME, SURNAME, PAY, HIRED_AT, TEAM) VALUES
(101, 'Arjun',   'Rao',      120000, '2018-03-15 09:00:00', 'Sales'),
(102, 'Sneha',   'Iyer',     90000,  '2019-07-22 10:15:00', 'Support'),
(103, 'Kabir',   'Malhotra', 280000, '2017-11-01 11:30:00', 'Sales'),
(104, 'Nisha',   'Singh',    450000, '2016-01-05 08:45:00', 'Finance'),
(105, 'Rohan',   'Mehta',    450000, '2020-06-10 12:00:00', 'Finance'),
(106, 'Priya',   'Kulkarni', 210000, '2021-02-14 14:10:00', 'Tech'),
(107, 'Vishal',  'Kumar',    70000,  '2022-09-09 16:00:00', 'Tech'),
(108, 'Dia',     'Chatterji',95000,  '2019-12-19 13:20:00', 'Support');

INSERT INTO Reward (STAFF_REF, AMOUNT, REWARD_DATE) VALUES
(101, 6000, '2021-02-20 00:00:00'),
(102, 2500, '2020-06-11 00:00:00'),
(103, 4000, '2022-02-20 00:00:00'),
(101, 5000, '2023-02-20 00:00:00'),
(105, 3500, '2020-06-11 00:00:00');

INSERT INTO Role (STAFF_REF, ROLE_NAME, EFFECTIVE_FROM) VALUES
(101, 'Lead',           '2022-02-20 00:00:00'),
(102, 'Associate',      '2020-06-11 00:00:00'),
(108, 'Associate',      '2020-06-11 00:00:00'),
(105, 'Manager',        '2021-06-11 00:00:00'),
(104, 'Sr. Manager',    '2019-06-11 00:00:00'),
(107, 'Associate',      '2022-06-11 00:00:00'),
(106, 'Engineer',       '2021-06-11 00:00:00'),
(103, 'Engineer',       '2018-06-11 00:00:00');

SELECT S.GIVEN_NAME, S.TEAM, Rl.ROLE_NAME, Rw.AMOUNT
FROM Staff S
INNER JOIN Role   Rl ON S.STAFF_ID = Rl.STAFF_REF
INNER JOIN Reward Rw ON S.STAFF_ID = Rw.STAFF_REF
WHERE Rw.AMOUNT > 2000;


SELECT S.GIVEN_NAME, S.TEAM, Rl.ROLE_NAME, Rw.AMOUNT
FROM Staff S
INNER JOIN Reward Rw ON S.STAFF_ID = Rw.STAFF_REF
INNER JOIN Role   Rl ON S.STAFF_ID = Rl.STAFF_REF
WHERE Rl.ROLE_NAME = 'Manager' AND Rw.AMOUNT = 5000;


SELECT *
FROM Staff S
CROSS JOIN Role Rl
WHERE S.PAY > 100000;


SELECT S.GIVEN_NAME, S.PAY, Rl.ROLE_NAME
FROM Staff S
LEFT JOIN Role Rl
  ON S.STAFF_ID = Rl.STAFF_REF;


SELECT S.GIVEN_NAME, S.PAY, Rw.AMOUNT
FROM Staff S
RIGHT JOIN Reward Rw
  ON S.STAFF_ID = Rw.STAFF_REF;


SELECT S.STAFF_ID, S.GIVEN_NAME, S.TEAM,
       Rw.AMOUNT, Rw.REWARD_DATE
FROM Staff S
LEFT JOIN Reward Rw ON S.STAFF_ID = Rw.STAFF_REF
UNION
SELECT S.STAFF_ID, S.GIVEN_NAME, S.TEAM,
       Rw.AMOUNT, Rw.REWARD_DATE
FROM Staff S
RIGHT JOIN Reward Rw ON S.STAFF_ID = Rw.STAFF_REF;
